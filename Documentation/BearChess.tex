
\documentclass[11pt,a4paper]{article}
\usepackage{graphicx}
\usepackage{float}
\usepackage{titlesec}
\usepackage{fancyhdr}
\pagestyle{fancy}
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
\fancyfoot[C]{\thepage}
\fancyfoot[L,R]{}
\fancyhead[C]{}
\fancyhead[L]{BearChess GUI}
\fancyhead[R]{Version 0.2.0.0}
\title{Chess GUI with support for electronic chess boards}
\author{Lars Nowak}
\date{14.11.2020} 

\begin{document}
\maketitle

\begin{abstract}
\textbf{Why yet another chess GUI?}\\

Many GUIs support electronic chess boards, but do not use the full potential that chess boards with piece recognition offer. They could be much better used for training or analysis of games and positions.

So the focus of BearChess is more on exploiting the possibilities of the chess boards than being just another GUI. Of course, you not need an electronic chess board to use BearChess.

The first version of BearChess supports the chess boards from Certabo and the boards connected via Millennium ChessLink.\\

As you can see from the version number, this software is still under development. There are still some functions that are not fully implemented and there are certainly still many bugs. But BearChess has now reached a level where it can be used and feedback from other users is welcome.\\

I am a professional programmer and write the software in my spare time and it is free. I am not an employee of Inventhio Srl trading (Certabo) or Millennium 2000 GmbH. If something does not work, Certabo or Millennium is not responsible for it.\\

Send errors, comments, suggestions for improvement or requests to lars@solanosoft.com.

\end{abstract}

\newpage
\tableofcontents
\newpage


\section{Quick start}
\begin{itemize}
	\item Simply unpack the file BearChessWin.zip into a new folder.
	\item Start BearChess with a double-click on BearChessWin.exe
	\item Connect your electronic chess board to your computer.
	\item Set all chessmen to their start position.
	\item Configure the electronic chess board connection.
	\item Connect to the electronic chess board.
	\item Load a chess engine.
	\item Start a game and make your first move on the eletronic chess board.
\end{itemize}

\section{Introduction}
BearChess offers the following functions:
\begin{enumerate}
	  \item Play with Certabo chess boards.
	  \item Play with Millennium chess boards via ChessLink modul.
  	  \item Play against human beings or UCI engines.
  	  \item Analyze your games or trainings with the help of electronic chess boards.
  	  \item Use multiple programs simultaneously.
  	  \item Support for Polyglot and Arena opening books.
  	  \item Save and load your games
  	  \item Individual chessmen and board colors.
\end{enumerate}

\section{Directories}
After the first start, BearChess creates some directories:
\begin{enumerate}
	\item \begin{verbatim}
C:\Users\YOURUSERS\AppData\Local\BearChess
	\end{verbatim} 
	\item\begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\BearChess\board
	\end{verbatim} 
	\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\BearChess\book
	\end{verbatim} 	
		\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\BearChess\log
	\end{verbatim} 	
		\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\BearChess\pieces
	\end{verbatim} 	
		\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\BearChess\uci
	\end{verbatim} 	

\end{enumerate}
\begin{quote}
YOURUSERS is a placeholder for your Windows user name.
\end{quote}

The first directory will contains some configuration files. The other directories will contain further configuration files, especially references to engines, opening books, piece sets and for the electronic chess boards.

\section{Calibration}
At the the first start, the engine needs a calibration to identify your chessmen. When a calibration is running, you will see the chessboard LEDs flashing each row. Please wait until all LEDs are off.\\A new calibration is only required if you use another set of chessmen.

\section{Configuration}

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.8]{configuration.jpg}
	\caption{Configuration}
	\label{fig:configration}
\end{figure}
\begin{itemize}
	\item \textbf{Calibrate} Initiate a new calibration. Please ensure that all chessmen are on the right place.
	\item \textbf{Play with white pieces} If not checked, you play with the black chessmen and place the black chessmen on the base row (reversed chessboard).

	\item \textbf{MultiPV} Set the number of multiple analyses. This option is only available if there files in the engines directory. This option is ignored on engine matches. With most GUIs this option is not displayed, except for example with Arena.
	
	\item \textbf{Engine} Select one UCI engine located in the engines directory. This option is only available if there files in the engines directory.

    \item \textbf{Analyze mode} Use the selected UCI engine to analyze your moves. This option is only available if there files in the engines directory.
    \item \textbf{Book} Use the selected opening book if you play against an engine. This option is only available if there files in the engines and books directory.
   \item \textbf{Book-Variation} Determine the usage of the book.
   \begin{itemize}
   	  \item \textbf{best move} Always plays the best move.
   	  \item \textbf{flexible} Plays the move considering the weighting or priority.
   	  \item \textbf{wide} Play every move from the book.
   \end{itemize}
    \item \textbf{COM-port} Select an available COM port if automatic detection fails. You can determine or change the correct COM port for the COM device driver in your Windows Device Manager.

\end{itemize}

\subsection{Intention of 'Analyze mode', 'UCI engine' and 'Opening book'}
In most cases you do not need or it make sense to select an UCI engine or opening book in the configuration dialog. Especially \textbf{not} when you are playing an engine match, because you will select your opponent by the GUI.\\The idea behind configuring an UCI engine within the Certabo engine is to use it in parallel to analyze your moves during the game. For this, select an UCI engine and check the ``Analyze mode`` box. Not to be confused with a post-game analysis, which is provided by most GUI's.\\
Some GUI's allow you to allow an engine to play against itself without initiating a complete engine match. With Arena, for example, you can do this by simply pressing the ``Demo`` button. Now, you can use the Certabo engine to play against another human being and the GUI is just recording your moves. Or, you configure an UCI engine and play against them in the same simple way. In this case uncheck the ``Analyze mode`` box. To make such a game more variable, you can select an opening book for the UCI engine.\\

\newpage
\section{Use Cases}
The following chapter describes some scenarios and how to manage them in different GUIâ€™s. Please understand that not all GUIs can be considered and some examples are only described for one GUI. I cannot guarantee that all scenarios will work smoothly under all GUI's.
\subsection{Play against another UCI engine}
\subsubsection{Fritz}
\paragraph{Engine Match}
\begin{enumerate}
	\item Start a new engine match.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_enginematch.jpg}
		\caption{Fritz Engine Match}
		\label{fig:FritzEngineMatch}
	\end{figure}
	\item Select Certabo engine for white.
		\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_enginewhite.jpg}
		\caption{Define Engine for White}
		\label{fig:FritzEngineWhite}
	\end{figure}
	\item Open the engine configuration dialog and uncheck ``Analyze mode`` and select ``\begin{math}<none>\end{math}`` as UCI engine.
			\begin{figure}[H]
		\centering
		\includegraphics[scale=0.8]{fritz_engine_configure_certabo.jpg}
		\caption{Configure Certabo Engine}
		\label{fig:FritzConfigureCertabo}
	\end{figure}

	\item Ensure the checkbox for ``Use book`` is unchecked.
		\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_engineusebook.jpg}
		\caption{Use Book}
		\label{fig:FritzUseBook}
	\end{figure}
	\item Select an engine installed in Fritz for black.
	\item Set your preferred time settings and start the match.	
\end{enumerate}

\subsubsection{Arena}
Arena allows different ways to play against another UCI engine. Common is that the Certabo UCI engine must not use the Arena opening book. Deactivate the option ``Use Arena general main books with this engine``.
		\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{arena_mainbooks.jpg}
	\caption{Certabo Arena Book}
	\label{fig:ArenaUseBook}
\end{figure}
\paragraph{With one Certabo engine and one UCI Engine}
\begin{enumerate}
\item Load Certabo engine as \mbox{``Engine 1``} and the opponent UCI engine as \mbox{``Engine 2``}.
	\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{arena_engine1.jpg}
	\caption{Certabo UCI as Engine 1}
	\label{fig:ArenaEngine1}
\end{figure}
\item Configure Engine 1 (Certabo engine)
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{arena_configureengine1.jpg}
	\caption{Configure Engine 1}
	\label{fig:ArenaConfigureEngine1}
\end{figure}
\item Open the engine configuration dialog and uncheck ``Analyze mode`` and select ``\begin{math} <none> \end{math}`` as UCI engine.
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.8]{Arena_ConfigureCertabo.jpg}
	\caption{Configure Certabo Engine}
	\label{fig:ArenaConfigureCertabo}
\end{figure}
\item Press ``Demo`` to start the game.
\begin{figure}[H]
	\centering
	\includegraphics[scale=0.7]{arena_demo.jpg}
	\caption{Run Demo}
	\label{fig:ArenaDemo}
\end{figure}
\end{enumerate}

\paragraph{With one Certabo engine}
\subparagraph{} If you have copied an UCI engine into the engine subfolder, you can use them as opponent.
\begin{enumerate}
	\item Close ``Engine 2`` if loaded.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.7]{arena_closeengine2.jpg}
		\caption{Close Engine 2}
		\label{fig:ArenaCloseEngine2}
	\end{figure}
    \item Open the Certabo engine configuration dialog and uncheck ``Analyze mode`` and select an UCI engine and an opening book if available.
    	\begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.8]{arena_ConfigureCertabo2.jpg}
    	\caption{Select an UCI Engine}
    	\label{fig:ArenaConfigureCertabo2}
    \end{figure}
    \item Press ``Demo`` to start the game.
    \begin{figure}[H]
    	\centering
    	\includegraphics[scale=0.7]{arena_demo.jpg}
    	\caption{Run Demo}
    	\label{fig:ArenaDemo}
    \end{figure}
\end{enumerate}

\paragraph{Engine Tournament}
\begin{enumerate}
\item Start an Engine Tournament
  \begin{figure}[H]
	\centering
	\includegraphics[scale=0.5]{arena_enginetournament.jpg}
	\caption{Arena Engine Tournament}
	\label{fig:ArenaEngineTournament}
\end{figure}
\item For the Certabo engine make sure that ``Analyze mode`` is unchecked and  ``\begin{math} <none> \end{math}`` as the selected UCI engine.
\end{enumerate}
You can add the Certabo engine twice with different names. So, you can play a tournament against yourself with different configurations, e.g. different UCI engines for analysis.

\subsection{Use an UCI engine for analysis}
In this case, the UCI engine shows you the analysis for your moves during the game. Opening books will be ignored.
\subsubsection{Fritz}
\paragraph{Engine Match}
\begin{enumerate}
	\item Start a new engine match.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_enginematch.jpg}
		\caption{Fritz Engine Match}
		\label{fig:FritzEngineMatch}
	\end{figure}
	\item Select Certabo engine for white.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_enginewhite.jpg}
		\caption{Define Engine for White}
		\label{fig:FritzEngineWhite}
	\end{figure}
	\item Open the engine configuration dialog and check ``Analyze mode`` and select an UCI engine.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.8]{fritz_engine_configure_certabo_analyze.jpg}
		\caption{Configure Certabo Engine}
		\label{fig:FritzConfigureCertabo}
	\end{figure}
	
	\item Ensure the checkbox for ``Use book`` is unchecked.
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.6]{fritz_engineusebook.jpg}
		\caption{Use Book}
		\label{fig:FritzUseBook}
	\end{figure}
	\item Select an engine installed in Fritz for black.
	\item Set your preferred time settings and start the match.	
\end{enumerate}
\subsubsection{Arena}
You can play an engine match like described above with Fritz but you can use the ``Demo`` mode, too. In Arena you can install the same engine with different parameters under a new name. So, you can play an engine match with two Certabo engines as opponent with different UCi engines for analysis. Arena allows you, a little bit aside by the UCI protocol definition, configure the MultiPV-Parameter for an engine match. This gives you the possibility to display several analysis lines during the games.

\subsection{Start from a position}
You can start from any chess position specified by the GUI. It is best to place the chessmen first on your Certabo chessboard and then use the setup position functionality of your GUI.
\subsubsection{Arena}
\begin{enumerate}
  \item Open the Set-up Position dialog and place the chessmen.
  \item Close the dialog and press the demo button. The chessboard LED indicate incorrectly placed or missing chessmen.
\end{enumerate}

\section{Important To Know}
\subsection{Log files}
The Certabo engine writes at least two log files into the log directory:
\begin{enumerate}
  \item certaboUci\_1.log
  \item certabo\_1.log
\end{enumerate}
If the GUI starts a second instance of the engine, e.g. you start an engine match against two Certabo UCI engines, the log files for the second engine are named certaboUCi\_2.log and certabo\_2.log.

\subsection{Calibration}
For the first time, the engine assumes that all chessmen are on their initial position and starts a calibration. The result is written into the file calibrate.xml in the directory \begin{verbatim}
C:\Users\YOURUSERS\AppData\Local\CertaboUci
\end{verbatim}

To recalibrate, just delete the file calibrate.xml or press the ``Calibrate`` button in the configuration dialog. Not all GUI's may supports buttons in the configuration dialog, e.g. HIARCS Chess Explorer v1.9.4 for Windows. In this case, you have to delete the file.

\subsection{Pawn conversion to a second queen}
The first time you perform a pawn conversion with a second queen on your board after calibration, the engine needs a few seconds to identify the new piece. Please wait until the LEDs are off.
The new piece code is saved. There is no delay next time.

\subsection{COM port}
The engine detects all available COM ports and uses the first one found. If you set another COM port on the configuration, may you have to restart the engine to activate it.

\subsection{Opening books}
The engine supports Polyglot and Arena opening books. The internal data structure of both are very different. In simple words, Polyglot is position oriented and Arena move oriented. You can use a Polyglot opening book for normal game or from any starting position. If you use an Arena opening book, the engine will not find the next move unless you start from the beginning of a game.

\section{Trouble shooting}


\subsection{The chess moves are not or not correctly displayed}
\begin{itemize}
	\item Check the correct COM port in the configuration dialog.
	\item Check the position of the chessmen. Moves are only accepted if the chessmen are on the correct square. Fields with missing or wrong figure light up.
	\item Try the engine from the CertaboUciCore.zip file.
	\item Finally, the UCI protocol is well defined but not every GUI send the commands in the same way. I test the engine with the common used GUI's but may some are different.
\end{itemize}

\subsection{The engine makes the moves itself}
\begin{itemize}
\item If you are playing an engine match, open the configuration dialog and select the option ``Analyze mode`` or set the UCI engine to ``<none>``.
\item Make sure that the GUI does not make the moves by using an opening book.
\end{itemize}

\section{Known Issues}
\begin{itemize}
	\item When no more moves are found in the opening book for the first time, the system no longer looks in the book for that game.
\end{itemize}

\section{Next Steps}
\begin{itemize}
	\item Error correction.
	\item Try to develop a version for Linux.
\end{itemize}

\pagebreak

\section{Changelog}
\subsection{Version 1.4.0 =\textgreater 1.4.1}
\begin{itemize}
	    \item Important bug fix for long castling. The rook was internally set to an invalid square.
\end{itemize}
\subsection{Version 1.3.0 =\textgreater 1.4.0}
\begin{itemize}
    \item The configuration type for ``Calibrate`` is changed from ``checkbox`` to ``button``.
	\item Support for Polyglot and Arena opening books.
    \item Automatic reconnection if the connection to the board is lost, e.g. if the cable is removed.
    \item Correction of output when using an UCI engine in analysis mode.
    \item Correction if two Certabo engines run simultaneously.
\end{itemize}
\subsection{Version 1.2.2 =\textgreater 1.3.0}
\begin{itemize}
	\item Support pawn conversion to a second queen.
	\item Allow to set the number of multiple analyses.
\end{itemize}
\subsection{Version 1.2.1 =\textgreater 1.2.2}
\begin{itemize}
	\item Bug fixing on run analyze mode with UCI engine in Fritz.
\end{itemize}

\subsection{Version 1.2.0 =\textgreater 1.2.1}
\begin{itemize}
	\item Bug fixing on configure COM port.
	\item Additional configuration file.
	\item Additional version based on .NET Core 3.1.0. Is mandatory if you use HIARCS Chess Explorer v1.9.4.
\end{itemize}
\subsection{Version 1.1.1 =\textgreater 1.2.0}
\begin{itemize}
	\item Allow to play from any starting position.
	\item Allow to configure the COM port.
	\item Improvements in calibration.
	\item Bug fixing on play with black.
	\item Bug fixing pawn conversion.
	\item New calibration data file format and content.
\end{itemize}
\subsection{Version 1.1 =\textgreater 1.1.1}
\begin{itemize}
	\item New configuration setting ``Play with white pieces``. If not checked, you play with the black pieces and place the black pieces on the base row (reversed chessboard).
\end{itemize}
\subsection{Version 1.0 =\textgreater 1.1}
\begin{itemize}
	\item The working directories are changed to 
\begin{enumerate}
	\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\CertaboUci
	\end{verbatim} 
	\item\begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\CertaboUci\log
	\end{verbatim} 
	\item \begin{verbatim}
	C:\Users\YOURUSERS\AppData\Local\CertaboUci\engines
	\end{verbatim} 	
\end{enumerate}
	\item You can use an UCI engine for analysis or playing against them.
	\item The GUI can start two instances of a Certabo UCI engine without conflict on access to the Certabo chessboard (serial port).
\end{itemize}

\end{document}